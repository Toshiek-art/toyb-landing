---
interface Props {
  policyHref?: string;
}

const { policyHref = "/privacy" } = Astro.props;
---

<aside
  class="consent-banner"
  data-consent-banner
  hidden
  aria-label="Cookie consent settings"
>
  <p>
    We use only essential storage by default. Optional cookies and scripts
    remain disabled until you provide consent.
  </p>
  <div class="consent-actions" aria-label="Consent actions">
    <a href={policyHref}>Privacy policy</a>
    <button
      type="button"
      class="button button-secondary"
      data-consent-action="rejected">Reject</button
    >
    <button
      type="button"
      class="button button-secondary"
      data-consent-action="accepted">Accept</button
    >
  </div>
</aside>

<script is:inline>
  (() => {
    const STORAGE_KEY = "toyb-consent";
    const banner = document.querySelector("[data-consent-banner]");
    if (!banner) return;

    const savedChoice = localStorage.getItem(STORAGE_KEY);
    if (savedChoice === "accepted" || savedChoice === "rejected") {
      banner.setAttribute("hidden", "");
      return;
    }

    banner.removeAttribute("hidden");
    const actions = banner.querySelectorAll("[data-consent-action]");
    actions.forEach((action) => {
      action.addEventListener("click", (event) => {
        const target = event.currentTarget;
        if (!(target instanceof HTMLElement)) return;
        const choice = target.dataset.consentAction;
        if (choice !== "accepted" && choice !== "rejected") return;

        localStorage.setItem(STORAGE_KEY, choice);
        banner.setAttribute("hidden", "");
      });
    });
  })();
</script>
